     1                                  [org 0x0100]
     2                                  
     3 00000000 E92800                      jmp start
     4                                  
     5 00000003 3412                        new_stack_segment: dw 0x1234
     6 00000005 FEFF                        new_stack_offset:  dw 0xFFFE
     7                                  
     8                                      switch_stack:
     9 00000007 55                              push bp
    10 00000008 89E5                            mov bp, sp
    11 0000000A 53                              push bx
    12 0000000B 56                              push si
    13                                  
    14 0000000C 89E3                            mov bx, sp
    15 0000000E 81EB0200                        sub bx, 2
    16                                  
    17 00000012 BEFCFF                          mov si, 0xFFFC
    18                                  
    19 00000015 8B6604                          mov sp, [bp + 4]
    20 00000018 8E5606                          mov ss, [bp + 6]
    21                                  
    22                                      loop1:
    23 0000001B FF34                            push word [si]
    24 0000001D 81EE0200                        sub si, 2
    25 00000021 39F3                            cmp bx, si
    26 00000023 75F6                            jnz loop1
    27                                  
    28                                      return: 
    29 00000025 5E                              pop si
    30 00000026 5B                              pop bx
    31 00000027 5D                              pop bp
    32 00000028 C20400                          ret 4
    33                                  
    34                                      start:  
    35 0000002B B8CDAB                          mov ax, 0xABCD    ; Test values
    36 0000002E B90000                  		mov cx, 0
    37                                  
    38 00000031 50                              push ax
    39 00000032 687B00                          push 123
    40                                  
    41 00000035 FF36[0300]                      push word [new_stack_segment]
    42 00000039 FF36[0500]                      push word [new_stack_offset]
    43 0000003D E8C7FF                          call switch_stack
    44                                  
    45 00000040 59                              pop cx
    46 00000041 5B                              pop bx
    47                                  
    48                                      end:
    49 00000042 B8004C                          mov ax, 0x4c00
    50 00000045 CD21                            int 21h
